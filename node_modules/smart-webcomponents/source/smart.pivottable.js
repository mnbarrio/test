
/* Smart UI v8.2.1 (2020-Dec) 
Copyright (c) 2011-2020 jQWidgets. 
License: https://htmlelements.com/license/ */ //

!function(e){var t={};function a(l){if(t[l])return t[l].exports;var r=t[l]={i:l,l:!1,exports:{}};return e[l].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,l){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(a.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(l,r,function(t){return e[t]}.bind(null,r));return l},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=89)}({89:function(e,t){Smart("smart-pivot-table",class extends Smart.Table{static get properties(){return{columnTotals:{value:!1,type:"boolean"},columnTotalsPosition:{value:"near",allowedValues:["near","far"],type:"string"},defaultSortByRowGroups:{value:!1,type:"boolean"},designer:{value:!1,type:"boolean"},designerPosition:{value:"far",allowedValues:["near","far"],type:"string"},drillDown:{value:!1,type:"boolean"},getDefaultSummaryFunction:{value:null,type:"function?"},grandTotal:{value:!1,type:"boolean"},groupLayout:{value:"default",allowedValues:["default","classic"],type:"string"},hideEmptyRows:{value:!1,type:"boolean"},messages:{value:{en:{calculation:"Calculation",center:"center",clear:"Clear",columns:"Columns",columnSettings:"Column settings",decimalPlaces:"Decimal places",decimalSeparator:"Decimal separator",details:"Details",dragHereRowGroups:"Drag here to set row groups",dragHereSummaries:"Drag here to set summaries",dragHerePivots:"Drag here to set pivots",fields:"Fields",filter:"Filter",filters:"Filters",grandTotal:"Grand Total",groupHeader:"Group",left:"left",moveTo:"Move to",negativesInBrackets:"Negatives in brackets",numberAlignment:"Number alignment",numberFormat:"Number format",numberPrefix:"Number prefix",notApplicable:"N/A",pivots:"Pivots",right:"right",row:"Row",rowGroups:"Row Groups",sameSummaryFunctionRequired:'smartPivotTable: When "columnTotals" is enabled, all summary columns must have the same "summary" function set (e.g. \'{{example}}\').',search:"Search...",showRows:"Show records where:",summaries:"Summaries",summaryRequired:'smartPivotTable: At least one column with "summary" is required.',textAlignment:"Text alignment",total:"Total",thousandsSeparator:"Thousands separator"}},type:"object",extend:!0},nullDefaultValue:{value:null,type:"number?"},rowGroupCount:{value:!0,type:"boolean",defaultReflectToAttribute:!0},rowSort:{value:!1,type:"boolean"},rowTotals:{value:!1,type:"boolean"},rowTotalsPosition:{value:"near",allowedValues:["near","far"],type:"string"},toolbar:{value:!1,type:"boolean"}}}static get listeners(){return{resize:"_overriddenTableHandler","designerContainer.change":"_designerChangeHandler","designerContainer.clear":"_designerFilterHandler","designerContainer.filter":"_designerFilterHandler","fieldsButton.click":"_fieldsButtonClickHandler","tableContainer.change":"_overriddenTableHandler","tableContainer.keyup":"_overriddenTableHandler","toolbar.close":"_breadcrumbCloseHandler","toolbar.dragEnd":"_breadcrumbDragEndHandler","toolbar.dragging":"_breadcrumbDraggingHandler"}}template(){return'<div id="container" class="smart-container" role="presentation">\n                    <div id="toolbar" class="smart-pivot-table-toolbar" role="toolbar">\n                        <smart-breadcrumb id="rowGroupBreadcrumb" class="smart-pivot-table-row-group-breadcrumb" allow-drag allow-drop animation="[[animation]]" close-buttons right-to-left="[[rightToLeft]]" theme="[[theme]]"></smart-breadcrumb>\n                        <smart-breadcrumb id="pivotBreadcrumb" class="smart-pivot-table-pivot-breadcrumb" allow-drag allow-drop animation="[[animation]]" close-buttons right-to-left="[[rightToLeft]]" theme="[[theme]]"></smart-breadcrumb>\n                        <smart-button id="conditionalFormattingButton" class="smart-table-toolbar-button conditional-formatting" animation="[[animation]]" right-to-left="[[rightToLeft]]" theme="[[theme]]" aria-label="Conditional Formatting"></smart-button>\n                        <smart-button id="fieldsButton" class="smart-table-toolbar-button fields" animation="[[animation]]" right-to-left="[[rightToLeft]]" theme="[[theme]]" aria-label="Fields"></smart-button>\n                    </div>\n                    <div id="main" class="smart-pivot-table-main-container">\n                        <table id="tableContainer" class="smart-table-container"></table>\n                    </div>\n                    <div id="designerContainer" class="smart-pivot-table-designer-container"></div>\n                </div>'}clearFilters(){this._filterInfo.appliedFilters&&(this._clearSortByRow(!0),delete this._filterInfo.appliedFilters,this._clearDesignerFilters(),this.dataSource.clearFilter(),this.refresh(!0),this._originalDynamicColumnsOrder=this._dynamicColumns.map(e=>e.id),this.$.fireEvent("filter",{action:"remove"}))}exportData(e,t,a){const l=this,r=getComputedStyle(l),i=r.borderRightColor,o={hierarchical:!0},n={},s=l._dynamicColumns;let d=[];if(s&&0!==s.length){if(o.style={border:"1px solid "+i,borderCollapse:"collapse",backgroundColor:r.backgroundColor,color:r.color,fontFamily:"Helvetica",header:{border:"1px solid "+i,fontWeight:"bold"},columns:{border:"1px solid "+i}},-1!==["csv","json","tsv","xml"].indexOf(e)){for(let e=0;e<s.length;e++){const t=s[e];t.group?n[t.id]=t.label:n[t.id]=t.dataFields.map(e=>e.label).join(" -> ")}d.push(n)}else{const e=[],t=[];for(let a=0;a<s.length;a++){const r=s[a],i=r.id,n={},d={};if(l._getColumnExportFormat(r,n,d),o.style.columns[i]=d,o.style.header[i]=n,r.group){n.width=1.25*l._cellWidth+"px",e.push({label:r.label,dataField:i});continue}n.width=l._cellWidth+"px";const c=r.dataFields,u={label:c[c.length-1].label,dataField:i};if(e.push(u),1!==c.length)for(let e=c.length-2;e>=0;e--){const a=c[e].label,l=c.slice(0,e+1).map(e=>e.label).join("_").replace(/[ ,]/g,"_");if(e===c.length-2&&(u.columnGroup=l),t.find(e=>e.name===l))continue;const r={label:a,name:l};c[e-1]&&(r.parentGroup=c[e-1].label.replace(/[ ,]/g,"_")),t.push(r)}}n.columns=e,n.columngroups=t,o.header=n}for(let t=0;t<l.rows.length;t++){const a=l.rows[t],r={};for(let t in a){if(-1!==["$","children","count","expanded","leaf","level","parent","sortOrder","tr"].indexOf(t))continue;if("id"===t){r._keyDataField=a.id;continue}if("parentid"===t){r._parentDataField=a.parentid;continue}const l=a[t];r[t]=0!==l?l:"pdf"===e?" ":""}!0!==a.leaf&&(r._expanded=!0===a.expanded),d.push(r)}return new Smart.Utilities.DataExporter(o).exportData(d,e,t,a)}}getDynamicColumns(){return this._dynamicColumns}sortBy(e,t){const a=this;let l;if(e){if(-1===a._dynamicColumns.indexOf(e)||0===a._rowGroupColumns.length)return;if(!1===e.dataFields[e.dataFields.length-1].originalColumn.allowSort)return;l=e.id}a._sortBy({column:e,columnDataField:l,sortOrder:t,dataFields:a._dynamicDataFields,columnByDataField:"_getDynamicColumnById"})}propertyChangedHandler(e,t,a){const l=this;function r(){l._dynamicColumns.filter(e=>e.rowTotal).forEach(e=>{delete l._getDynamicColumnById[e.id],l._dynamicDataFields=l._dynamicDataFields.filter(t=>t.name!==e.id)}),l._dynamicColumns=l._dynamicColumns.filter(e=>!0!==e.rowTotal)}switch(e){case"animation":case"rightToLeft":case"theme":super.propertyChangedHandler(e,t,a),l._designer&&(l._designer[e]=a,"rightToLeft"===e&&(l._designer.inverted=l.designer&&("near"===l.designerPosition&&!a||"far"===l.designerPosition&&a)));break;case"columns":l._conditionalFormatting&&delete l._conditionalFormatting,l._updateColumns(),l._formattingPanel&&(l._formattingPanel.columns=l._aggregateColumns.map(e=>({label:`${e.summary}(${e.label})`,dataField:e.dataField,dataType:"number"})));break;case"columnTotals":l._clearSortByRow(!0),l.refresh(!0),l._originalDynamicColumnsOrder=l._dynamicColumns.map(e=>e.id);break;case"columnTotalsPosition":{if(!l.columnTotals)return;l._clearSortByRow(!0,!0),r();const e=l._dynamicColumns.filter(e=>e.columnTotal&&0===e.pivotLevel),t=l._dynamicColumns.filter(e=>e.group),i=[];!function e(t,l){for(let r=0;r<t.length;r++){const i=t[r];"far"===a&&i.columnTotal&&e(i.children,l),l.push(i),"near"===a&&i.columnTotal&&e(i.children,l)}}(e,i),t.push(...i),l._dynamicColumns=t,l._addRowTotalsDynamicColumnDefinitions(),l.refresh(void 0,l._getCurrentDataStructure()),l._originalDynamicColumnsOrder=l._dynamicColumns.map(e=>e.id);break}case"conditionalFormatting":l._applyInitialConditionalFormatting(l.rows),l.refresh(void 0,l._getCurrentDataStructure());break;case"dataSource":delete l._dataSourceSortedByDefault,delete l._filterInfo.appliedFilters,l._sortColumns=[],l._clearSortByRow(!0),l._clearDesignerFilters(),l._validateDataSource(),l.refresh(!0),l._originalDynamicColumnsOrder=l._dynamicColumns.map(e=>e.id);break;case"designer":a&&(l._designer?(l._dialog&&l._dialog.classList.contains("fields")&&l._dialog.close(),l._designer.inverted="near"===l.designerPosition&&!l.rightToLeft||"far"===l.designerPosition&&l.rightToLeft,l.$.designerContainer.appendChild(l._designer)):l._initDesigner(l.$.designerContainer));break;case"designerPosition":l.designer&&(l._designer.inverted="near"===a&&!l.rightToLeft||"far"===a&&l.rightToLeft);break;case"disabled":case"unfocusable":case"keyboardNavigation":super.propertyChangedHandler(e,t,a),l._designer&&(l._designer.unfocusable=l.disabled||l.unfocusable||!l.keyboardNavigation);break;case"filtering":a||l.clearFilters();break;case"grandTotal":a?(l.footerRow="footer",l.freezeFooter=!0,l._createGrandTotalRow(l.rows.boundHierarchy,!0)):(l.footerRow=null,l.freezeFooter=!1,l.$.tableContainer.querySelector("tfoot").remove());break;case"groupLayout":l.refresh(void 0,l._getCurrentDataStructure());break;case"hideEmptyRows":l._rowGroupColumns.length>0&&l.refresh(!0,l._getCurrentDataStructure());break;case"locale":case"messages":if(super.propertyChangedHandler(e,t,a),l._rowGroupColumns){const e=l.$.tableContainer.querySelectorAll(".smart-pivot-table-grouping-header");e[e.length-1].innerHTML=l.localize("groupHeader")}l.columnTotals&&l._dynamicColumns.forEach(e=>{e.columnTotal&&(e.cell.textContent=`${l._totalSummaryFunction}(${l.localize("total")})`)}),l._designer&&(l._designer[e]=l[e]);break;case"rowSort":!a&&l._sortRow&&l._clearSortByRow();break;case"rowTotals":case"rowTotalsPosition":{if(0===l._pivotColumns.length||"rowTotalsPosition"===e&&!l.rowTotals)return;let t=!1;l._clearSortByRow(!0,!0),"rowTotals"===e?a?(t=!0,l._addRowTotalsDynamicColumnDefinitions()):r():"rowTotalsPosition"===e&&(r(),l._addRowTotalsDynamicColumnDefinitions()),l.refresh(t,l._getCurrentDataStructure()),l._originalDynamicColumnsOrder=l._dynamicColumns.map(e=>e.id);break}case"selection":l.refresh(void 0,l._getCurrentDataStructure()),a?(l.$.tableContainer.setAttribute("aria-multiselectable",!0),l._updateSelectAllState()):l.$.tableContainer.removeAttribute("aria-multiselectable");break;default:super.propertyChangedHandler(e,t,a)}}_updateColumns(e){const t=this,a=t._filterInfo.appliedFilters;if(delete t._filterInfo.appliedFilters,t._sortColumns=[],t._clearSortByRow(!0),t._initColumns(),t._designerFiltersApplied)if(e){t._applyingDesignerFilters=!0,t._restoringFilters=!0;for(const e in a)t.addFilter(e,a[e]);delete t._applyingDesignerFilters,delete t._restoringFilters}else t._clearDesignerFilters();t.refresh(!0),t._originalDynamicColumnsOrder=t._dynamicColumns.map(e=>e.id)}_createElement(){const e=this;e.classList.add("smart-table"),e._cellWidth=parseFloat(getComputedStyle(e.$.container).getPropertyValue("--smart-pivot-table-cell-width")),e._autoScrollCoefficient*=2,e._filterInfo={},e.$.header={offsetHeight:0},e.$.pager={offsetHeight:0},e.grandTotal&&(e.footerRow="footer",e.freezeFooter=!0),e._setMainContainerMaxHeight(),e._localize(),e._validateDataSource(),e._initColumns(),e.refresh(!0),e.designer&&e._initDesigner(e.$.designerContainer),e._originalDynamicColumnsOrder=(e._dynamicColumns||[]).map(e=>e.id)}_setMainContainerMaxHeight(){const e=getComputedStyle(this.$.container).maxHeight;isNaN(parseFloat(e))||(this.$.main.style.maxHeight=`calc(${e} - 2 * var(--smart-border-width)`)}_validateDataSource(){const e=this,t=e.dataSource;if(!(t instanceof Smart.DataAdapter))if(Array.isArray(e.dataSource)){let a;if(t.length>0){const e=t[0];a=[];for(let t in e){const l=e[t];"number"==typeof l?a.push({name:t,dataType:"number"}):"boolean"==typeof l?a.push({name:t,dataType:"boolean"}):l instanceof Date?a.push({name:t,dataType:"date"}):a.push({name:t,dataType:"string"})}}e.dataSource=new Smart.DataAdapter({dataSource:e.dataSource,dataFields:a})}else e.dataSource=new Smart.DataAdapter({dataSource:[]})}_processPivotColumns(){const e=this,t=e.columnTotals,a=[],l=[],r=[],i=[],o=[];let n,s=e.dataSource;if(0===e._columns.length)return!1;for(let s=0;s<e._columns.length;s++){const d=e._columns[s];d.pivot&&d.allowPivot&&(a.push(d),i.push(d.dataField)),d.rowGroup&&d.allowRowGroup&&(l.push(d),o.push(d.dataField)),d.summary&&(r.push(d),n?t&&n!==d.summary&&e.error(e.localize("sameSummaryFunctionRequired",{example:n})):n=d.summary)}return 0===r.length&&e.error(e.localize("summaryRequired")),e._groupByPrimary=i,e._groupBySecondary=o,e._pivotColumns=a,e._rowGroupColumns=l,e._aggregateColumns=r,e._totalSummaryFunction=n,e.defaultSortByRowGroups&&!e._dataSourceSortedByDefault&&l.length>0&&(s=new Smart.DataAdapter({dataSource:e._defaultSortByRowGroups(s),dataFields:s.dataFields}),e.dataSource=s),s.groupBy=i,s.refreshHierarchy(),e._primaryHierarchy=s.boundHierarchy,e.$.rowGroupBreadcrumb.dataSource=l.map(e=>({label:e.label,value:e})),e.$.pivotBreadcrumb.dataSource=a.map(e=>({label:e.label,value:e})),!0}refresh(e,t){const a=this,l=a.isRendered;if(a.columns.canNotify=!1,l&&!t&&(a.$.tableContainer.innerHTML=""),t){const e=a.$.tableContainer.firstElementChild,l=document.createDocumentFragment();e.innerHTML="",a._createHeaderCells(t,l),e.appendChild(l)}else{if(!a._processPivotColumns())return;a._createHeader()}a._hideColumnTotalsBorder(),e&&(a._createAggregatesSource(),a._applyInitialConditionalFormatting(a.rows)),a._createDataRows(!t);const r=a._sortColumns;l&&(e||t)&&r&&(delete a._sortColumns,r.forEach(e=>{const t=a._getDynamicColumnById[e.dataField];t&&(delete t.sortOrder,a.sortBy(t,e.direction))})),a.columns.canNotify=!0}_createHeader(){const e=this,t=e.columnTotals,a=e.columnTotalsPosition,l=document.createElement("thead"),r=document.createDocumentFragment(),i=e._pivotColumns.length,o=[];function n(a,l,r){if(t)for(let t=0;t<=i;t++)t<a?o[t].push(l[t]):t===a?o[t].push(r.label):t===i?o[t].push(`TL="${a}"${e._totalSummaryFunction}(${e.localize("total")})`):o[t].push("")}function s(a){const l=e._aggregateColumns;return t&&0===a&&o[0].push(`TL="0"${e._totalSummaryFunction}(${e.localize("total")})`),l.forEach(e=>{o[a].push(`${e.summary}(${e.label})`)}),l.length}for(let e=0;e<=i;e++)o.push([]);i>0?function t(l,r,i){let d=0;for(let c=0;c<l.length;c++){const u=l[c];let m=0;e._filterInfo.appliedFilters&&!e._areChildrenFiltered(void 0,u.children)||("near"===a&&n(r,i,u),u.children&&u.children.length>0&&!0!==u.children[0].leaf?m+=t(u.children,r+1,i.concat([u.label])):m+=s(r+1),"far"===a&&n(r,i,u),o[r].push(...Array(m).fill(u.label)),d+=m)}return d}(e._primaryHierarchy,0,[]):s(0),e._createDynamicColumnDefinitions(o),e._createHeaderCells(o,r),l.appendChild(r),e.$.tableContainer.appendChild(l)}_createDynamicColumnDefinitions(e){const t=this,a=e[e.length-1].length,l=[],r=[],i={};let o=-1;t._dynamicColumns=l,t._dynamicDataFields=r,t._getDynamicColumnById=i;for(let n=0;n<a;n++){const a=e[e.length-1][n];if(t._createTotalColumnDefinition(a,e,n))continue;const s={dataFields:[]},d=[];o++;for(let a=0;a<e.length-1;a++){const l=e[a][n],r=t._pivotColumns[a],i={originalColumn:r,label:l,dataField:r.dataField};s.dataFields.push(i),d.push(l),e[a][n]={label:l,columnDefinition:s,info:i}}const c=t._aggregateColumns[o%t._aggregateColumns.length],u={originalColumn:c,label:a,dataField:c.dataField,summary:c.summary};s.dataFields.push(u),d.push(c.dataField),e[e.length-1][n]={label:a,columnDefinition:s,info:u},s.id=d.join(",").replace(/[ ,]/g,"_"),l.push(s),r.push({name:s.id,dataType:"any"}),i[s.id]=s}if(t._rowGroupColumns.length>0){const e=t.localize("groupHeader"),a={dataFields:t._rowGroupColumns.map(t=>({originalColumn:t,label:e})),id:"group",label:e,group:!0};let o;l.unshift(a),i.group=a;for(let e=0;e<a.dataFields.length&&(o=a.dataFields[e].originalColumn.dataType,"string"!==o);e++);r.push({name:"group",dataType:o}),r.push({name:"count",dataType:"number"})}t._setColumnTotalsRelations(),t._addRowTotalsDynamicColumnDefinitions(),t.$.tableContainer.removeAttribute("aria-colcount")}_createTotalColumnDefinition(e,t,a){const l=this,r=/TL="(\d+)"/.exec(e);if(!r)return!1;const i=parseFloat(r[1]),o={dataFields:[]},n=[];e=e.replace(/TL="(\d+)"/,"");for(let e=0;e<t.length-1;e++){if(e>i){t[e][a]=Object.assign({},t[e-1][a],{label:""});continue}const r=t[e][a],s=l._pivotColumns[e],d={originalColumn:s,label:r,dataField:s.dataField};o.dataFields.push(d),n.push(r),t[e][a]={label:r,columnDefinition:o,info:d}}return n.push("TOTAL"),o.columnTotal=!0,o.emptyCells=[],o.expanded=!1,o.id=n.join(",").replace(/[ ,]/g,"_"),o.pivotLevel=i,t[t.length-1][a]={label:e,columnDefinition:o,info:{originalColumn:{},label:e,dataField:"TOTAL"}},l._dynamicColumns.push(o),l._dynamicDataFields.push({name:o.id,dataType:"any"}),l._getDynamicColumnById[o.id]=o,!0}_setColumnTotalsRelations(){const e=this;if(!e.columnTotals)return;const t=e._dynamicColumns;for(let a=0;a<e._dynamicColumns.length;a++){const l=e._dynamicColumns[a];if(!l.columnTotal)continue;const r=l.id.replace("_TOTAL","");let i;0===e._pivotColumns.length?(l.expanded=!0,i=t.filter(e=>{if(!e.columnTotal&&!e.group)return e.parent=l,!0})):i=l.pivotLevel===e._pivotColumns.length-1?t.filter(e=>{if(!e.columnTotal&&0===e.id.indexOf(r))return e.parent=l,!0}):t.filter(e=>{if(e.columnTotal&&e.pivotLevel===l.pivotLevel+1&&0===e.id.indexOf(r))return e.parent=l,!0}),l.children=i}}_addRowTotalsDynamicColumnDefinitions(){const e=this;if(!e.rowTotals||0===e._pivotColumns.length)return;const t=[];e._aggregateColumns.forEach(a=>{const l=a.dataField,r="TOTAL_"+l,i={dataFields:[{originalColumn:a,label:`${a.summary}(${a.label})`,dataField:l,summary:a.summary}],id:r,rowTotal:!0};t.push(i),e._getDynamicColumnById[r]=i,e._dynamicDataFields.push({name:r,dataType:"any"})}),"near"===e.rowTotalsPosition?e._dynamicColumns.splice(0+Number(e._rowGroupColumns.length>0),0,...t):e._dynamicColumns.push(...t)}_createHeaderCells(e,t){const a=this,l=e[e.length-1].length,r=a.columnTotals,i=a.selection,o=a.onColumnRender,n=a.rowTotalsPosition,s=a._rowGroupColumns.length>0,d=a._cellWidth;function c(t,a){if(0===a)return!0;let l=t,r=!1;for(;l>=0&&!r;){const t=e[l][a-1],i=e[l][a];r=t.label!==i.label||JSON.stringify(t.info)!==JSON.stringify(i.info),l--}return r}for(let u=0;u<e.length;u++){const m=document.createElement("tr"),p=e[u];if(i)if(u===e.length-1)m.innerHTML='<th class="smart-pivot-table-selection-header smart-table-select-all freeze-near"><div role="checkbox" aria-checked="false" aria-label="Toggle selection of all rows"></div></th>';else{const e=document.createElement("th");0===u&&(e.style.width=getComputedStyle(a.$.container).getPropertyValue("--smart-table-row-height")),e.classList.add("smart-pivot-table-selection-header","freeze-near"),m.appendChild(e)}s&&a._createGroupHeaderCells(u,e,m),"near"===n&&a._createRowTotalsHeaders(u,e,m);const h={};for(let t=0;t<l;t++){let i=p[t],n=i.label,s=i.columnDefinition;if(void 0===n)break;const g=document.createElement("th");if(c(u,t)){if(h.cell&&!r&&(h.span>1&&(h.cell.colSpan=h.span),0===u&&(h.cell.style.width=d*h.span+"px")),t===l-1&&0===u?r||(g.style.width=d+"px"):(h.cell=g,h.span=1),g.columnDefinition=s,s.columnTotal&&""===n)s.emptyCells.push(g),g.classList.add("empty");else if(o){const e={text:n,cell:g,column:i.info,fullDefinition:s};a.onColumnRender(e),n=e.text}u===e.length-1&&(a._addSortingCapability(g,s),n=`<div class="wrapper" role="presentation"><div class="label">${n}</div></div>`),i.info.originalColumn.align&&g.classList.add("align-"+i.info.originalColumn.align),g.innerHTML=n,r&&a._processColumnTotalsHeaderCells(g,s,u),m.appendChild(g)}else h.span++,t!==l-1||r||(h.cell.colSpan=h.span,0===u&&(h.cell.style.width=d*h.span+"px"))}"far"===n&&a._createRowTotalsHeaders(u,e,m),t.appendChild(m)}}_createGroupHeaderCells(e,t,a){const l=this,r="classic"===l.groupLayout,i=r?l._rowGroupColumns.length:1;for(let o=0;o<i;o++){const i=document.createElement("th");if(i.classList.add("smart-pivot-table-grouping-header"),e===t.length-1){const e=l._dynamicColumns[0];let t=r?e.dataFields[o].originalColumn.label:l.localize("groupHeader");if(l.onColumnRender){const a={text:t,cell:i,column:e.dataFields[0],fullDefinition:e};l.onColumnRender(a),t=a.text}0===o&&(l._addSortingCapability(i,e),t=`<div class="wrapper" role="presentation"><div class="label">${t}</div></div>`),i.innerHTML=t}a.appendChild(i)}}_processColumnTotalsHeaderCells(e,t,a){const l=this,r=l.columnTotalsPosition;if(a<l._pivotColumns.length&&!e.classList.contains("empty")){const i=document.createElement("div");if(i.className="total-arrow smart-arrow smart-arrow-right",i.setAttribute("role","button"),i.setAttribute("aria-label","Toggle column"),!l.keyboardNavigation||l.disabled||l.unfocusable||(i.tabIndex=0),e.appendChild(i),"far"!==r||t.columnTotal)e.controller=t;else{let r=l._pivotColumns.length,i=t;for(;r>a;)i=i.parent,r--;e.controller=i}e.controller.arrowCell=e,l._getColumnTotalColspan(e)}const i=function e(t){return!!t.parent&&(!t.parent.expanded||e(t.parent))}(t);t.hidden=i,"near"===r?(e.classList.toggle("smart-hidden",i),e.classList.toggle("expanded",t.expanded)):(e.controller&&t!==e.controller||e.classList.toggle("smart-hidden",i),t.arrowCell&&t.arrowCell!==e&&(t.arrowCell.classList.toggle("smart-hidden",i),t.arrowCell.classList.toggle("expanded",t.expanded)))}_getColumnTotalColspan(e){const t=function e(t){let a=1;if(t.expanded)for(let l=0;l<t.children.length;l++){const r=t.children[l];r.columnTotal?a+=e(r):a+=1}return a}(e.controller);t>1?e.colSpan=t:e.removeAttribute("colspan"),e.style.width=this._cellWidth*t+"px"}_createRowTotalsHeaders(e,t,a){const l=this;if(l.rowTotals&&0!==l._pivotColumns.length)for(let r=0;r<l._aggregateColumns.length;r++){const i=l._getDynamicColumnById["TOTAL_"+l._aggregateColumns[r].dataField],o=document.createElement("th");if(o.classList.add("smart-pivot-table-total-header"),e===t.length-1){let e=i.dataFields[0].label;if(l.onColumnRender){const t={text:e,cell:o,column:i.dataFields[0],fullDefinition:i};l.onColumnRender(t),e=t.text}o.innerHTML=`<div class="wrapper" role="presentation"><div class="label">${e}</div></div>`,l._addSortingCapability(o,i)}a.appendChild(o)}}_createAggregatesSource(){const e=this,t=e.dataSource,a=e.hideEmptyRows,l=e._aggregateColumns,r=[],i=[],o={id:0,totals:[]},n=[],s=e._selectedIds.slice(0);let d;for(let e=0;e<l.length;e++){const t=l[e],a={};a[t.dataField]=[t.summary],i.push(a)}function c(t,a){for(let l=e._groupByPrimary.length-1;l>=0;l--){const r=t[e._groupByPrimary[l]],i=a[e._groupByPrimary[l]];if(r instanceof Date){if(r.getTime()!==i.getTime())return!1}else if(r!==i)return!1}return!0}if(e._originalRecords={},0===e._rowGroupColumns.length?(!function a(l,r){if(0!==e._pivotColumns.length)for(let n=0;n<l.length;n++){const s=l[n];if(s.children&&s.children.length>0){const l=r.concat([s.label]);if(!0!==s.children[0].leaf)a(s.children,l);else{const a=s.children.filter(e=>!1!==e.$.filtered);if(0===a.length)continue;const r=t.summarize(i,a);e._setRowValue(o,l,r,a)}}}else{const a=e.dataSource.toArray().filter(e=>!1!==e.$.filtered);if(0===a.length)return;const l=t.summarize(i,a);e._setRowValue(o,r,l,a)}}(e._primaryHierarchy,[]),r.push(o),n.push(o.id)):(d=e._groupByPrimary[e._groupByPrimary.length-1],function l(o,s,u){let m=e._getSecondaryHierarchy(o);if(s)for(let e=0;e<u.length;e++)m=m[u[e]].children;m.forEach((m,p)=>{let h=m.children.length;if(e._filterInfo.appliedFilters&&(h=e._areChildrenFiltered(void 0,m.children),!1===m.data.$.filtered&&!h))return;const g={},f=new Smart.DataAdapter({dataSource:m.children,dataFields:t.dataFields,groupBy:e._groupByPrimary});if(s&&(g.parentid=s.id),g.id=(s?s.id:"")+m.label+o,g.level=o,g.totals=[],n.push(g.id),function a(l,r,o,n){if(0!==e._pivotColumns.length)for(let s=0;s<l.length;s++){const u=l[s];if(u.children&&u.children.length>0&&!0!==u.children[0].leaf)a(u.children,r,o,n.concat([u.label]));else{const a=r.children.filter(e=>!1!==e.$.filtered&&(!d||c(u.data,e)));if(0===a.length)continue;const l=n.concat([u.label]).filter(e=>void 0!==e),s=t.summarize(i,a);e._setRowValue(o,l,s,a)}}else{const a=r.children.filter(e=>!1!==e.$.filtered);if(a.length>0){const l=t.summarize(i,a);e._setRowValue(o,n,l,a)}}}(f.boundHierarchy||f,m,g,[]),a){let e=!0;for(const t in g){if(-1!==["children","count","expanded","group","id","level","parent","parentid","totals","tr"].indexOf(t))continue;const a=g[t];if(0!==a&&null!==a){e=!1;break}}if(e)return void(s&&(s.hiddenChildren?s.hiddenChildren++:s.hiddenChildren=1))}r.push(g),o<e._groupBySecondary.length-1&&l(o+1,g,u.concat([p])),g.hiddenChildren&&(h-=g.hiddenChildren,delete g.hiddenChildren),g[e._dynamicColumns[0].id]=m.label,g.count=h})}(0,void 0,[])),e._setRowTotalsSource(r,i),e._setColumnTotalsSource(r),e.rows=new Smart.DataAdapter({dataSource:r,id:"id",keyDataField:"id",parentDataField:"parentid",dataFields:e._dynamicDataFields}),!e.isRendered&&e.onInit&&e.onInit(),s.length>0){const t=[];for(let e=0;e<s.length;e++)-1!==n.indexOf(s[e])&&t.push(s[e]);e._selectedIds=t}delete e._selectionStart,e.selection&&e._updateSelectAllState()}_setRowValue(e,t,a,l){const r=this;let i=[];r._aggregateColumns.forEach(o=>{const n=o.dataField,s=a[n][o.summary],d=t.concat([n]).join(",").replace(/[ ,]/g,"_");e[d]=s,r._originalRecords[e.id+d]=l,i.push({dataPoint:s})}),e.totals=e.totals.concat(l)}_setRowTotalsSource(e,t){const a=this;if(!a.rowTotals||0===a._pivotColumns.length)return;const l=new Smart.DataAdapter({dataSource:[],dataFields:a.dataSource._dataFields});for(let r=0;r<e.length;r++){const i=e[r],o=i.id,n=i.totals,s=l.summarize(t,n);for(let e in s)i["TOTAL_"+e]=Object.values(s[e])[0],a._originalRecords[o+"TOTAL_"+e]=n;delete i.totals}}_setColumnTotalsSource(e){const t=this;if(!t.columnTotals)return;const a=t._dynamicColumns.filter(e=>e.columnTotal),l=new Smart.DataAdapter({dataSource:[],dataFields:[{name:"dataPoint"}]});for(let r=0;r<e.length;r++){const i=e[r],o=i.id;for(let e=0;e<a.length;e++){const r=a[e],n=t._getColumnTotalsOriginalRecords(r,o);0!==n.length&&(t._originalRecords[o+r.id]=n,i[r.id]=t._getTotalSummary(n,l))}}}_getTotalSummary(e,t){const a=[];return this._aggregateColumns.forEach(t=>{e.forEach(e=>{a.push({dataPoint:e[t.dataField]})})}),t.summarize([{dataPoint:[this._totalSummaryFunction]}],a).dataPoint[this._totalSummaryFunction]}_getSecondaryHierarchy(e){const t=this.dataSource;return t.groupBy=this._groupBySecondary.slice(0,e+1),t.refreshHierarchy(),t.boundHierarchy}_createDataRows(e){const t=this,a=t.rows.boundHierarchy,l=document.createDocumentFragment();let r;a&&("default"===t.groupLayout?t._createRowElements(a,l):(t._expanded=[],t._hidden={},t._rowGroupColumns.forEach((e,a)=>{t._expanded.push([]),t._hidden[a]=!1}),t._createRowElementsClassic(a,l))),l.appendChild(t._createLastRow()),e?(r=document.createElement("tbody"),t.$.tableContainer.appendChild(r)):(r=t.$.tableContainer.querySelector("tbody"),r.innerHTML=""),r.appendChild(l),t._createGrandTotalRow(a,e),"classic"===t.groupLayout&&t._updateGroupColumnsVisibility(),t.getRootNode().activeElement===t.$.tableContainer&&t._tableContainerFocusHandler()}_createRowElements(e,t){const a=this,l=a.selection,r=a._dynamicColumns;for(let i=0;i<e.length;i++){const o=document.createElement("tr"),n=e[i],s=n.level;if(n.tr=o,o.data=n,l){const e=document.createElement("td"),t=-1!==a._selectedIds.indexOf(n.$.id);e.className=`smart-table-select-row freeze-near${t?" selected":""}`,e.innerHTML=`<div class="selection-checkbox" role="checkbox" aria-checked="${t}" aria-label="Toggle row selection"></div>`,o.appendChild(e),o.setAttribute("aria-selected",t)}for(let e=0;e<r.length;e++){const t=document.createElement("td"),l=r[e],i=n[l.id];let d,c,u=i;if(0===e&&l.group){const e=n.leaf;d=l.dataFields[s].originalColumn,u=a._formatCellValue(n,d,t,u),u=`${u}<span class="group-label-count"> (${n.count})</span>`,e||(t.classList.add("tree-cell"),c=!0),s>0&&(t.classList.add("outline-level-"+s),e&&t.classList.add("tree-leaf")),d.align&&t.classList.add("align-"+d.align),n.sortOrder&&(t.classList.add("sort-by",n.sortOrder),t.setAttribute("aria-sort",n.sortOrder+"ending"))}else d=l.columnTotal?a._aggregateColumns[0]:l.dataFields[l.dataFields.length-1].originalColumn,u=a._formatSummaryValue(n,d,t,u);a.onCellRender&&a.onCellRender(n,l,i,t),a._applyConditionalFormattingToCell(t,l.id,n.$.index),t.setAttribute("data-field",l.id),t.classList.toggle("smart-hidden",!0===l.hidden),a._setCellContent(t,u,c),o.appendChild(t)}n.expanded&&(o.setAttribute("aria-expanded",!0),o.classList.add("expanded")),s>0&&a._isCollapsed(n)&&(o.setAttribute("aria-hidden",!0),o.classList.add("collapsed","smart-hidden")),o.setAttribute("row-id",n.$.id),t.appendChild(o),n.children&&a._createRowElements(n.children,t)}}_createRowElementsClassic(e,t){const a=this,l=a.selection,r=a._dynamicColumns;for(let i=0;i<e.length;i++){const o=e[i],n=o.level;if(n>0&&0===i){o.expanded&&a._expanded[n].push(o),o.children&&a._createRowElementsClassic(o.children,t);continue}const s=document.createElement("tr");let d=a._getRecordToDisplay(o);if(o.tr=s,s.data=o,o.expanded&&(s.setAttribute("aria-expanded",!0),s.classList.add("expanded"),a._expanded[n].push(o)),n>0&&a._isCollapsed(o)&&(s.setAttribute("aria-hidden",!0),s.classList.add("collapsed","smart-hidden")),l){const e=document.createElement("td"),t=-1!==a._selectedIds.indexOf(o.$.id);e.className=`smart-table-select-row freeze-near${t?" selected":""}`,e.innerHTML=`<div class="selection-checkbox" role="checkbox" aria-checked="${t}" aria-label="Toggle row selection"></div>`,s.appendChild(e),s.setAttribute("aria-selected",t)}for(let e=0;e<r.length;e++){const t=r[e];let l,i=o[t.id],n=i;if(0===e&&t.group){a._createGroupCellsClassic(s,o,t,i);continue}const c=document.createElement("td");i=d[t.id],n=i,l=t.columnTotal?a._aggregateColumns[0]:t.dataFields[t.dataFields.length-1].originalColumn,n=a._formatSummaryValue(d,l,c,n),a.onCellRender&&a.onCellRender(d,t,i,c),a._applyConditionalFormattingToCell(c,t.id,d.$.index),c.setAttribute("data-field",t.id),c.classList.toggle("smart-hidden",!0===t.hidden),a._setCellContent(c,n),s.appendChild(c)}s.setAttribute("row-id",o.$.id),t.appendChild(s),o.children&&a._createRowElementsClassic(o.children,t)}}_updateGroupColumnsVisibility(){const e=this,t=e._expanded;function a(e){return!e.parent||!!e.parent.expanded&&a(e.parent)}if(!(t.length<2)){for(let l=0;l<t.length-1;l++){const r=t[l],i=l+1;let o=0;if(r.forEach(e=>o+=Number(a(e))),0===o&&!e._hidden[i]||o>0&&e._hidden[i]||e._hidden[l]&&!e._hidden[i]){e._hidden[i]=!e._hidden[i],Array.from(e.$.tableContainer.querySelectorAll(`.smart-pivot-table-grouping-header:nth-child(${i+1+Number(e.selection)})`)).concat(Array.from(e.$.tableContainer.querySelectorAll(`td[data-field="group${i}"]`))).forEach(t=>t.classList.toggle("smart-hidden",e._hidden[i]))}}if(e._focusedCell&&e._focusedCell.classList.contains("smart-hidden")&&-1!==e._focusedCell.getAttribute("data-field").indexOf("group")){let t=e._focusedCell.previousElementSibling;for(;t.classList.contains("smart-hidden");)t=t.previousElementSibling;e._focusCell(t)}}}_getRecordToDisplay(e){return e.leaf||!e.expanded?e:this._getRecordToDisplay(e.children[0])}_getFirstChildAtLevel(e,t){let a=t.children[0];for(;a.children&&a.level!==e;)a=a.children[0];return a}_createGroupCellsClassic(e,t,a,l){const r=this,i=r._rowGroupColumns.length,o=t.level;for(let n=0;n<i;n++){const i=document.createElement("td");if(i.setAttribute("data-field","group"+n),e.appendChild(i),n<o)continue;let s,d=t,c=a.dataFields[n].originalColumn;n>o?(d=r._getFirstChildAtLevel(n,t),l=d[a.id]):i.classList.add("main"),d.sortOrder&&(i.classList.add("sort-by",d.sortOrder),i.setAttribute("aria-sort",d.sortOrder+"ending"));let u=l;u=r._formatCellValue(d,c,i,u),u=`${u}<span class="group-label-count"> (${d.count})</span>`,d.leaf||(i.data=d,s=!0,i.classList.add("tree-cell"),d.expanded&&i.classList.add("expanded","main")),c.align&&i.classList.add("align-"+c.align),r.onCellRender&&r.onCellRender(d,a,l,i),r._applyConditionalFormattingToCell(i,a.id,t.$.index),r._setCellContent(i,u,s)}}_createGrandTotalRow(e,t){const a=this;if(!a.grandTotal||0===a._rowGroupColumns.length||!e)return;const l=a.columnTotals,r=a._dynamicColumns,i=l?new Smart.DataAdapter({dataSource:[],dataFields:[{name:"dataPoint"}]}):void 0,o=document.createElement("tr"),n={grandTotal:!0};let s;function d(e){const t=[{}],r=e.dataFields[e.dataFields.length-1],i=r.dataField;return t[0][i]=[l?a._totalSummaryFunction:r.summary],t}if(a.selection){const e=document.createElement("td");e.className="freeze-near",o.appendChild(e)}for(let t=0;t<r.length;t++){const l=document.createElement("td"),s=r[t];let c,u,m;if(0===t&&s.group)c=a.localize("grandTotal"),u=c,a._sortRow&&a._sortRow.grandTotal&&(n.sortOrder=a._sortRow.sortOrder,a._sortRow=n,l.classList.add("sort-by",n.sortOrder),l.setAttribute("aria-sort",n.sortOrder+"ending"));else{const t=s.columnTotal?a._aggregateColumns[0]:s.dataFields[s.dataFields.length-1].originalColumn;let r=[];for(let t=0;t<e.length;t++){const l=a._originalRecords[e[t].id+s.id];l&&(r=r.concat(l))}0!==r.length&&(s.columnTotal?(m=a._getTotalSummary(r,i),c=m):(m=a.rows.summarize(d(s),r),c=Object.values(Object.values(m)[0])[0]),a._originalRecords["GRAND_TOTAL"+s.id]=r),u=c,void 0!==m&&void 0!==u&&(u=a._formatSummaryValue(m,t,l,u))}if(a.onCellRender&&a.onCellRender(m,s,c,l),n[s.id]=void 0!==c?c:0,l.setAttribute("data-field",s.id),l.classList.toggle("smart-hidden",!0===s.hidden),a._setCellContent(l,u),o.appendChild(l),0===t&&s.group&&"classic"===a.groupLayout){l.setAttribute("data-field","group0");for(let e=1;e<a._rowGroupColumns.length;e++){const t=document.createElement("td");t.setAttribute("data-field","group"+e),o.appendChild(t)}}}o.classList.add("grand-total"),o.data=n,t?(s=document.createElement("tfoot"),a.$.tableContainer.appendChild(s)):(s=a.$.tableContainer.querySelector("tfoot"),s.innerHTML=""),s.appendChild(o)}_formatSummaryValue(e,t,a,l){const r=this;let i=t.summarySettings;if(t.formatFunction||!i)return r._formatCellValue(e,t,a,l);if(i.align&&a.classList.add("align-"+i.align),isNaN(l)||""===l|null===l)return r._formatCellValue(e,t,a,l);let o=l;if(void 0!==i.decimalPlaces||void 0!==i.thousandsSeparator&&""!==i.thousandsSeparator||void 0!==i.decimalSeparator){const e=new Smart.Utilities.NumberRenderer(l);let t="F";void 0!==i.thousandsSeparator&&""!==i.thousandsSeparator&&(e.localizationObject.thousandsseparator=i.thousandsSeparator,t="N"),void 0!==i.decimalSeparator&&(e.localizationObject.decimalseparator=i.decimalSeparator),isNaN(i.decimalPlaces)&&(i.decimalPlaces=e.localizationObject.defaultPrecision),o=e.formatNumber(l,t+i.decimalPlaces)}return!0===i.negativesInBrackets&&l<0&&(o=`(${o.toString().replace("-","")})`),void 0!==i.prefix&&(o=i.prefix.toString()+o),r._formatCellValue(e,t,a,o)}_overriddenTableHandler(){}_hierarchyArrowClickHandler(e,t){const a=this;let l,r,i;if("classic"===a.groupLayout){for(t=t&&t.data?t:Array.from(e.querySelectorAll('td[data-field^="group"]')).find(e=>e.data);!t.classList.contains("main")&&!t.previousElementSibling.classList.contains("expanded");)t=t.previousElementSibling;l=t.data;const o=l.level;i=l.children,r=!l.expanded,l.expanded=r,0===o?(e.setAttribute("aria-expanded",r),e.classList.toggle("expanded",r)):o>0&&l===l.parent.children[0]&&t.classList.toggle("main",r);let n=l.children[0],s=t.nextElementSibling;for(;n&&!n.leaf&&n.expanded;)s.classList.toggle("main",r),n=n.children[0],s=t.nextElementSibling;t.classList.toggle("expanded",r),r?a._expanded[o].push(l):a._expanded[o]=a._expanded[o].filter(e=>e!==l),a._updateDisplayedRecord(l,e),a._updateGroupColumnsVisibility()}else l=e.data,i=l.children,r=!l.expanded,l.expanded=r,e.setAttribute("aria-expanded",r),e.classList.toggle("expanded",r);r?(requestAnimationFrame(()=>function e(t){t.forEach(t=>{const l=t.children;a._expandSingleChildRow(t.tr),l&&t.expanded&&requestAnimationFrame(()=>e(l))})}(i)),a.$.fireEvent("expand",{record:l})):(!function e(t){t.forEach(t=>{const l=t.children;a._collapseSingleChildRow(t.tr),l&&e(l)})}(i),a.$.fireEvent("collapse",{record:l}))}_updateDisplayedRecord(e,t){const a=this;if("classic"!==a.groupLayout)return;const l=a._getRecordToDisplay(e);for(let e=0;e<a._dynamicColumns.length;e++){const r=a._dynamicColumns[e],i=r.id;if("group"===i)continue;const o=t.querySelector('td[data-field="'+i+'"]'),n=r.columnTotal?a._aggregateColumns[0]:r.dataFields[r.dataFields.length-1].originalColumn;let s=l[r.id];s=a._formatSummaryValue(l,n,o,s),o.style.backgroundColor=null,o.style.color=null,o.style.fontFamily=null,o.style.fontSize=null,a._applyConditionalFormattingToCell(o,r.id,l.$.index),a._setCellContent(o,s)}}_addSortingCapability(e,t){const a=this;t.cell=e,"group"!==t.id&&e.setAttribute("data-field",t.id),0!==a._rowGroupColumns.length&&(t.headerCellElement=e,e.onclick=function(){const l=t.dataFields[t.dataFields.length-1].originalColumn;a.$.fireEvent("columnClick",{columnDefinition:t,dataField:l.dataField}),"none"===a.sortMode||!1===l.allowSort||a._preventClickSort||(a._addSortIconContainer(t),e.sortIconContainerElement.classList.contains("asc")?a.sortBy(t,"desc"):e.sortIconContainerElement.classList.contains("desc")?a.sortBy(t,null):a.sortBy(t,"asc"))})}_sortCallback(e,t,a){const l=this.rows;l._sort(l.boundSource,e,t,a),l.refreshHierarchy(),this._createDataRows()}_selectAllCheckboxClickHandler(e){super._selectAllCheckboxClickHandler(e,this.rows)}_updateSelectAllState(){super._updateSelectAllState(this.rows.length)}_refreshFilters(e){const t=this,a=[];for(const e in t._filterInfo.appliedFilters){let l=t._filterInfo.appliedFilters[e];a.push([e,l])}0!==a.length?(t.dataSource._filter(a,t._applyingDesignerFilters?"and":"or"),t._applyingDesignerFilters||t.refresh(!0),t._restoringFilters&&t.$.fireEvent("filter",{action:e,filters:a})):t.clearFilters()}_areChildrenFiltered(e,t){if(1===arguments.length&&(t=e.children),!t||0===t.length)return;let a=0;for(let e=0;e<t.length;e++)!1===t[e].leaf?a+=this._areChildrenFiltered(void 0,t[e].children)?1:0:!1!==t[e].$.filtered&&a++;return a}_localize(){this.$.rowGroupBreadcrumb.placeholder=this.localize("dragHereRowGroups"),this.$.pivotBreadcrumb.placeholder=this.localize("dragHerePivots"),this.$.conditionalFormattingButton.setAttribute("tooltip",this.localize("conditionalFormatting")),this.$.fieldsButton.setAttribute("tooltip",this.localize("fields"))}_columnNotify(e){const t=this,a=e.propertyName,l=e.target;switch(a){case"allowFilter":{const a=t._designer;if(a&&a._filtersViewInitialized){const r=Array.from(a.$.filtersView.querySelectorAll("smart-filter-panel")).find(e=>e.column.dataField===l.dataField);r&&(!1===e.newValue?(r.closest("smart-accordion-item.filtered")&&(t._clearDesignerFilters(l.dataField),t._designerFilterHandler({target:r})),r.disabled=!0):r.disabled=!1)}break}case"allowPivot":if(!0!==l.pivot)return;break;case"allowRowGroup":if(!0!==l.rowGroup)return;break;case"pivot":if(!0!==l.allowPivot)return;break;case"rowGroup":if(!0!==l.allowRowGroup)return;break;case"summary":if(!e.newValue&&e.oldValue&&1===t._aggregateColumns.length||t.columnTotals&&e.newValue!==t._totalSummaryFunction)return void(l.summary=e.oldValue)}t._refreshColumns()}_refreshColumns(){const e=this;e._columns=e.columns._array,e.columnByDataField=[],e._columns.forEach(t=>e.columnByDataField[t.dataField]=t),e.refresh(!0),e._designer&&(e._designer.columns=JSON.parse(JSON.stringify(e._columns)))}_initDesigner(e){const t=this.rightToLeft,a=document.createElement("smart-pivot-panel");a.animation=this.animation,a.columns=JSON.parse(JSON.stringify(this._columns)),a.dataSource=this.dataSource.toArray(),a.inverted=e===this.$.designerContainer&&("near"===this.designerPosition&&!t||"far"===this.designerPosition&&t),a.locale=this.locale,a.messages=this.messages,a.rightToLeft=t,a.theme=this.theme,a.unfocusable=!this.keyboardNavigation||this.disabled||this.unfocusable,a.ownerElement=this,this._designer=a,e&&e.appendChild(a)}_designerChangeHandler(e){(this.isInShadowDOM?e.composedPath()[0]:e.target)instanceof Smart.PivotPanel!=!1&&(this.columns=e.detail.columns,this._updateColumns(!0))}_designerFilterHandler(){const e=this,t=Array.from(e._designer.$.filtersView.querySelectorAll("smart-filter-panel")),a=[];if(t.forEach(e=>{const t=e.column,l=e.getFilter();l.filters.length>0&&a.push([t.dataField,l])}),e._filterInfo.appliedFilters){if(0===a.length)return void e.clearFilters();delete e._filterInfo.appliedFilters,e.dataSource.clearFilter()}e._applyingDesignerFilters=!0,a.forEach(t=>e.addFilter(...t)),delete e._applyingDesignerFilters,e.refresh(!0),e._designerFiltersApplied=!0}_clearDesignerFilters(e){if(!this._designerFiltersApplied||this._applyingDesignerFilters)return;const t=this._designer,a=t.view,l=Array.from(t.$.filtersView.querySelectorAll("smart-filter-panel"));t.view="filters",l.forEach(t=>{e&&e!==t.column.dataField||(t._filterHandler.excelClear(),t.closest("smart-accordion-item").classList.remove("filtered"))}),t.view=a}_setFocusable(){const e=this,t=!e.keyboardNavigation||e.disabled||e.unfocusable;super._setFocusable(),e._designer&&(e._designer.unfocusable=t);const a=Array.from(e.$.tableContainer.getElementsByClassName("total-arrow"));t?a.forEach(e=>e.removeAttribute("tabindex")):a.forEach(e=>e.setAttribute("tabindex",0))}_addDragFeedback(){const e=this,t=e._dragDetails.Item,a=document.createElement("div");return a.className="smart-table-feedback",a.setAttribute("parent-table-id",e.id),a.innerHTML=t.columnDefinition.dataFields.map(e=>e.label).join("â†’"),e.theme&&a.setAttribute("theme",e.theme),document.body.appendChild(a),a}_applyColumnReorder(e,t){const a=this.rightToLeft,l=this._dynamicColumns,r=e.Item.columnDefinition,i=t.classList.contains("right"),o=this._dynamicColumns.filter(e=>e!==r),n=o.indexOf(t.columnDefinition);t.classList.remove("drop-column","left","right"),i&&!a||!i&&a?o.splice(n+1,0,r):o.splice(n,0,r),l.map(e=>e.id).join(",")!==o.map(e=>e.id).join(",")&&(this._clearSortByRow(!0),this._dynamicColumns=o,this.refresh(void 0,this._getCurrentDataStructure()))}_getCurrentDataStructure(){const e=this,t=e._dynamicColumns,a=[],l=`${e._totalSummaryFunction}(${e.localize("total")})`;let r=Number(e._rowGroupColumns.length>0),i=0;if(e.rowTotals&&e._pivotColumns.length>0){const t=e._aggregateColumns.length;"near"===e.rowTotalsPosition?r+=t:i=t}const o=t.find(e=>!e.rowTotal&&!e.columnTotal&&!e.group).dataFields.length;for(let e=0;e<o;e++)for(let n=r;n<t.length-i;n++){void 0===a[e]&&(a[e]=[]);const r=t[n];if(r.columnTotal){const t=r.dataFields[e];e===o-1?a[e].push({label:l,columnDefinition:r,info:{dataField:"TOTAL",label:l,originalColumn:{}}}):t?a[e].push({label:t.label,columnDefinition:r,info:t}):a[e].push({label:"",columnDefinition:r,info:r.dataFields[e-1]})}else a[e].push({label:r.dataFields[e].label,columnDefinition:r,info:r.dataFields[e]})}return a}_breadcrumbCloseHandler(e){const t=this.columns.find(t=>t.dataField===e.detail.item.value.dataField);t&&((this.isInShadowDOM?e.composedPath()[0]:e.target===this.$.rowGroupBreadcrumb)?t.rowGroup=void 0:t.pivot=void 0)}_breadcrumbDragEndHandler(e){const t=this,a=t.isInShadowDOM?e.composedPath()[0]:e.target,l=a===t.$.rowGroupBreadcrumb,r=t._breadcrumbOperation;let i=t.columns.find(t=>t.dataField===e.detail.item.data.value.dataField);if("forbidden"===r)return void(a.dataSource=l?t._rowGroupColumns.map(e=>({label:e.label,value:e})):t._pivotColumns.map(e=>({label:e.label,value:e})));const o=t.columns;if("remove"!==r){if("reorder"===r){const a=e.detail.target;if(!a)return;const l=a.data.value;if(void 0===i||void 0===l||i.dataField===l.dataField)return;const r=e.detail.droppedBeforeTarget?"top":"bottom",n=o.findIndex(e=>e.dataField===i.dataField);let s=o.findIndex(e=>e.dataField===l.dataField);if(n>s&&"bottom"===r||n<s&&"top"===r)return;o.canNotify=!1,o.splice(n,1),s=o.findIndex(e=>e.dataField===l.dataField),"bottom"===r?o.splice(s+1,0,i):o.splice(s,0,i),t.columns=o,o.canNotify=!0}else r instanceof HTMLElement&&(r.$.container.classList.remove("drop-target"),o.canNotify=!1,r===t.$.rowGroupBreadcrumb||t._designer&&r===t._designer.$.rowGroupsTree?(i.pivot=void 0,i.rowGroup=!0):t._designer&&r===t._designer.$.summariesTree?(i[l?"rowGroup":"pivot"]=void 0,i.summary=t._getDefaultSummaryFunction(i)):(r===t.$.pivotBreadcrumb||t._designer&&r===t._designer.$.pivotsTree)&&(i.rowGroup=void 0,i.pivot=!0),o.canNotify=!0);t._refreshColumns()}else l?i.rowGroup=void 0:i.pivot=void 0}_getDefaultSummaryFunction(e){const t=this;return t.columnTotals?t._totalSummaryFunction:t.getDefaultSummaryFunction?t.getDefaultSummaryFunction(e):"count"}_breadcrumbDraggingHandler(e){const t=this,a=t.isInShadowDOM?e.composedPath()[0]:e.target,l=a._dragDrop.dragDetails.feedback,r=e.detail.item.data.value,i=e.detail.originalEvent,o=t._isMobile?t.getRootNode().elementFromPoint(i.clientX,i.clientY):t.isInShadowDOM?i.composedPath()[0]:i.target;let n,s;if(l){if(l.classList.remove("cancel","delete","row-group","summary","pivot"),t._breadcrumbOperation&&t._breadcrumbOperation instanceof HTMLElement&&t._breadcrumbOperation.$.container.classList.remove("drop-target"),a.contains(o))s="reorder";else if(o===document)n="delete",s="remove";else{const e=t._designer;if(s=o.closest("smart-breadcrumb, smart-tree"),s&&s instanceof Smart.Breadcrumb)s===t.$.rowGroupBreadcrumb&&!r.allowRowGroup||s===t.$.pivotBreadcrumb&&!r.allowPivot?(n="cancel",s="forbidden"):n=s===t.$.rowGroupBreadcrumb?"row-group":"pivot";else if(s&&e&&s!==e.$.columnsTree)switch(s){case e.$.rowGroupsTree:a===t.$.rowGroupBreadcrumb?(n="row-group",s="forbidden"):r.allowRowGroup?n="row-group":(n="cancel",s="forbidden");break;case e.$.summariesTree:n="summary";break;case e.$.pivotsTree:a===t.$.pivotBreadcrumb?(n="pivot",s="forbidden"):r.allowPivot?n="pivot":(n="cancel",s="forbidden")}else n="delete",s="remove"}n&&l.classList.add(n),t._breadcrumbOperation=s,s instanceof HTMLElement&&s.$.container.classList.add("drop-target")}}_tableContainerClickHandler(e){const t=this,a=t.isInShadowDOM?e.composedPath()[0]:e.target;if(a.classList.contains("total-arrow"))t._totalArrowClickHandler(a);else{if(t.rowSort&&!a.classList.contains("hierarchy-arrow")){const e=a.closest('td[data-field^="group"]');if(e){if("classic"===t.groupLayout&&(""===e.textContent||e.closest('td:not(.expanded)+td[data-field^="group"]:not(.main), td.expanded:not(.main)+td[data-field^="group"]:not(.main)')))return;return void t._sortByRow(e)}}super._tableContainerClickHandler(e)}}_tableContainerKeydownHandler(e){const t=this,a=t.getRootNode().activeElement;"Enter"===e.key&&a.classList.contains("total-arrow")?t._totalArrowClickHandler(a):"F2"===e.key&&t._focusedCell?t._drillDown({cell:t._focusedCell,dataField:t._focusedCell.getAttribute("data-field"),rowElement:t._focusedCell.parentElement}):super._tableContainerKeydownHandler(e)}_totalArrowClickHandler(e){const t=this,a=e.parentElement,l=a.controller;l.expanded?(l.expanded=!1,function e(a){if(a.children)for(let l=0;l<a.children.length;l++){const r=a.children[l];Array.from(t.$.tableContainer.querySelectorAll(`td[data-field="${r.id}"]`)).forEach(e=>e.classList.add("smart-hidden")),e(r),r.hidden=!0,r.cell.classList.add("smart-hidden"),r.columnTotal&&(r.arrowCell.classList.add("smart-hidden"),r.emptyCells.forEach(e=>e.classList.add("smart-hidden")))}}(l),t.$.fireEvent("collapseTotalColumn",{columnDefinition:l})):(l.expanded=!0,function e(a){if(a.children)for(let l=0;l<a.children.length;l++){const r=a.children[l];Array.from(t.$.tableContainer.querySelectorAll(`td[data-field="${r.id}"]`)).forEach(e=>e.classList.remove("smart-hidden")),r.expanded&&e(r),r.hidden=!1,r.cell.classList.remove("smart-hidden"),r.columnTotal&&(r.arrowCell.classList.remove("smart-hidden"),r.emptyCells.forEach(e=>e.classList.remove("smart-hidden")))}}(l),t.$.fireEvent("expandTotalColumn",{columnDefinition:l})),a.classList.toggle("expanded",l.expanded),function e(a){const l=a.controller;t._getColumnTotalColspan(a),l.parent&&e(l.parent.arrowCell)}(a),t._hideColumnTotalsBorder()}_hideColumnTotalsBorder(){if(!this.columnTotals)return;const e=this.$.tableContainer.firstElementChild;Array.from(e.querySelectorAll(".last-visible")).forEach(e=>e.classList.remove("last-visible"));for(let t=1;t<e.childElementCount;t++){const a=e.children[t].querySelectorAll("th:not(.smart-hidden)");a[a.length-1].classList.add("last-visible")}}_getColumnExportFormat(e,t,a){if(e.columnTotal)return;const l=e.dataFields[e.dataFields.length-1].originalColumn;if(l.align&&(e.group?a.textAlign=l.align:t.textAlign=l.align),e.group||!l.summarySettings)return;const r=l.summarySettings;let i="#.",o=!1;r.align&&(a.textAlign=r.align),void 0!==r.thousandsSeparator&&""!==r.thousandsSeparator&&(i="#"+r.thousandsSeparator+i,o=!0),void 0!==r.decimalPlaces&&(i+="0".repeat(r.decimalPlaces),o=!0),void 0!==r.prefix&&(i=r.prefix.toString()+i,o=!0),r.negativesInBrackets&&(i=`${i};(${i})`,o=!0),o&&(a.format=i)}_beginEdit(e){this._drillDown(e)}_drillDown(e){const t=this,a=e.dataField;if(/^group\d*$/g.test(a))return;const l=e.rowElement,r=e.cell,i=document.createElement("div"),o=document.createElement("smart-table"),n=t._dynamicColumns.find(e=>e.id===a),s=[],d=JSON.parse(JSON.stringify(t._columns)),c=t.localize("total");let u,m,p,h,g=l.data;if(g&&!l.classList.contains("grand-total"))if("classic"===t.groupLayout&&(g=t._getRecordToDisplay(g)),u=g.$.id,g.group){for(m=[g.group.replace(/ \(\d+\)/,"")],h=g.parent;h;)m.push(h.group.replace(/ \(\d+\)/,"")),h=h.parent;m=m.reverse().join("â†’")}else m=t.localize("notApplicable");else u="GRAND_TOTAL",m=t.localize("grandTotal");if(n.rowTotal)s.push(c);else if(n.columnTotal){for(let e=0;e<=n.dataFields.length-1;e++)s.push(n.dataFields[e].label);s.push(c),p=`${t._totalSummaryFunction}(${c})`}else for(let e=0;e<n.dataFields.length-1;e++)s.push(n.dataFields[e].label);const f=t._originalRecords[u+n.id];f&&0!==f.length&&(i.innerHTML=`<div class="drill-down-details">\n                <span>${t.localize("row")}:</span><strong>${m}</strong>\n                <span>${t.localize("column")}</span><strong>${s.join("â†’")||t.localize("notApplicable")}</strong>\n                <span>${p||n.dataFields[n.dataFields.length-1].label}:</span><strong>${r.textContent}</strong>\n            </div>`,i.appendChild(o),d.forEach(e=>e.width=t._cellWidth),o.columns=d,o.dataSource=new window.Smart.DataAdapter({dataSource:f,dataFields:t.dataSource._dataFields}),o.freezeHeader=!0,o.keyboardNavigation=t.keyboardNavigation,t._openDialog(t.localize("details"),i,"drill-down"))}_getColumnTotalsOriginalRecords(e,t){const a=this;let l=[];for(let r=0;r<e.children.length;r++){const i=e.children[r];if(!i.columnTotal){const e=a._originalRecords[t+i.id];e&&(l=e);break}l=l.concat(a._getColumnTotalsOriginalRecords(i,t))}return l}_conditionalFormattingButtonClickHandler(e){const t=this._aggregateColumns.map(e=>({label:`${e.summary}(${e.label})`,dataField:e.dataField,dataType:"number"}));super._conditionalFormattingButtonClickHandler(e,t,this.rows)}_applyConditionalFormatting(){const e=this,t=e._conditionalFormatting;e._conditionalFormatting=e._formattingPanel.apply(),e.conditionalFormatting=e._formattingPanel.getItems(),e._conditionalFormatting!==t&&e.refresh(void 0,e._getCurrentDataStructure())}_fieldsButtonClickHandler(){const e=this;e._designer?e._designer.inverted=!1:e._initDesigner(),e._openDialog(e.localize("fields"),e._designer,"fields")}_addDialogHandlers(){const e=this._dialog;e.addEventListener("change",this._dialogEventHandler),e.addEventListener("clear",this._dialogEventHandler),e.addEventListener("filter",this._dialogEventHandler),super._addDialogHandlers()}_dialogEventHandler(e){const t=e.type;if(-1===["change","clear","filter"].indexOf(t))return void super._dialogEventHandler(e);const a=this.ownerElement;if(!(this.isInShadowDOM?e.composedPath()[0]:e.target).closest("smart-pivot-panel"))return;const l=a.context;a.context=a,"change"===t?a._designerChangeHandler(e):a._designerFilterHandler(e),a.context=l}_sortByRow(e){const t=this,a=t.columnTotalsPosition,l=t._originalDynamicColumnsOrder,r=e.parentElement,i=r.data;let o=i;function n(e){"asc"===o.sortOrder?e.sort((function(e,t){return e.value-t.value})):e.sort((function(e,t){return t.value-e.value}))}if("classic"===t.groupLayout&&(o=e.data?e.data:t._getRecordToDisplay(i)),o.sortOrder?"asc"===o.sortOrder?o.sortOrder="desc":delete o.sortOrder:o.sortOrder="asc",t._sortRow&&t._sortRow!==o&&delete t._sortRow.sortOrder,o.sortOrder){if(t.columnTotals){const e=[];if(function e(l,r){const i=[];for(const e of l)i.push({dynamicColumnName:e.id,value:o[e.id]});n(i);for(const l of i){const i=t._getDynamicColumnById[l.dynamicColumnName];"near"===a&&r.push(i),i.children&&e(i.children,r),"far"===a&&r.push(i)}}(t._dynamicColumns.filter(e=>e.columnTotal&&0===e.pivotLevel),e),t._rowGroupColumns.length>0&&e.unshift(t._dynamicColumns[0]),t.rowTotals){const a=t._dynamicColumns.filter(e=>e.rowTotal);"near"===t.rowTotalsPosition?e.splice(1,0,...a):e.push(...a)}t._dynamicColumns=e}else{let e=[];Object.keys(o).filter(e=>-1===["$","children","count","expanded","group","id","leaf","level","parent","parentid","sortOrder","tr"].indexOf(e)).forEach(t=>{e.push({dynamicColumnName:t,value:o[t]})}),n(e),t._dynamicColumns=t._dynamicColumns.sort((function(a,l){return a.group||a.rowTotal||l.group||l.rowTotal?t._dynamicColumns.indexOf(a)-t._dynamicColumns.indexOf(l):e.findIndex(e=>e.dynamicColumnName===a.id)-e.findIndex(e=>e.dynamicColumnName===l.id)}))}t._sortRow=o}else t._dynamicColumns=t._dynamicColumns.sort((function(e,t){return l.findIndex(t=>t===e.id)-l.findIndex(e=>e===t.id)})),delete t._sortRow;t.refresh(void 0,t._getCurrentDataStructure()),t._focusCell(t.$.tableContainer.querySelector(`tr[row-id="${r.getAttribute("row-id")}"] td[data-field="${e.getAttribute("data-field")}"]`))}_clearSortByRow(e,t){const a=this;if(!a._sortRow)return;if(delete a._sortRow.sortOrder,delete a._sortRow,e&&!t)return;const l=a._originalDynamicColumnsOrder;a._dynamicColumns=a._dynamicColumns.sort((function(e,t){return l.findIndex(t=>t===e.id)-l.findIndex(e=>e===t.id)})),e||a.refresh(void 0,a._getCurrentDataStructure())}_defaultSortByRowGroups(e){const t=this,a=t._rowGroupColumns,l=a.find(e=>-1!==e.dataField.toLowerCase().indexOf("month")&&"string"===e.dataType),r=new Smart.DataAdapter({dataSource:e,dataFields:e.dataFields}),i=[],o=[],n=[];let s;if(a.forEach(e=>{i.push(e.dataField),o.push("asc"),n.push(e.dataType)}),l){const e=new Intl.DateTimeFormat(t.locale,{month:"long"}),a=[0,1,2,3,4,5,6,7,8,9,10,11].map(t=>e.format(new Date(2e3,t,1)));s=function(e,t,i,o){e.sort((function(e,r){for(let n=0;n<t.length;n++){if(l.dataField===t[n])return a.indexOf(e.month)-a.indexOf(r.month);const s=o[n](e[t[n]],r[t[n]]);if(0===s){if(t[n+1])continue;return void 0!==e.$.index?(e.$.index-r.$.index)*("asc"===i[n]?1:-1):0}return s*("asc"===i[n]?1:-1)}}));for(let t=0;t<e.length;t++)r[t]=e[t]}}return r._sort(r.boundSource,i,o,n,s),t._dataSourceSortedByDefault=!0,r.toArray()}}),Smart("smart-pivot-panel",class extends Smart.BaseElement{static get properties(){return{columns:{value:[],type:"any",reflectToAttribute:!1},dataSource:{value:[],type:"any?",reflectToAttribute:!1},inverted:{value:!1,type:"boolean"},messages:{value:{en:{calculation:"Calculation",cancel:"Cancel",center:"center",clear:"Clear",columns:"Columns",columnSettings:"Column settings",decimalPlaces:"Decimal places",decimalSeparator:"Decimal separator",dragHereRowGroups:"Drag here to set row groups",dragHereSummaries:"Drag here to set summaries",dragHerePivots:"Drag here to set pivots",filter:"Filter",filters:"Filters",left:"left",moveTo:"Move to",negativesInBrackets:"Negatives in brackets",numberAlignment:"Number alignment",numberFormat:"Number format",numberPrefix:"Number prefix",ok:"OK",pivots:"Pivots",right:"right",rowGroups:"Row Groups",search:"Search...",showRows:"Show records where:",summaries:"Summaries",textAlignment:"Text alignment",thousandsSeparator:"Thousands separator"}},type:"object",extend:!0},view:{value:"columns",allowedValues:["columns","filters"],type:"string"}}}static get listeners(){return{keydown:"_keydownHandler","columnsView.click":"_settingsIconClickHandler","columnsView.dragEnd":"_dragEndHandler","columnsView.dragging":"_draggingHandler","filtersView.clear":"_filterPanelFilterHandler","filtersView.expanding":"_accordionItemExpandingHandler","filtersView.filter":"_filterPanelFilterHandler","summariesTree.dragStart":"_summariesTreeDragStartHandler","tabs.click":"_tabsClickHandler"}}template(){return'<div id="container" role="presentation">\n                    <div id="main" role="presentation">\n                        <div id="columnsView" class="smart-pivot-panel-columns-view" role="tabpanel">\n                            <div id="columns" class="smart-pivot-panel-columns-container" role="presentation">\n                                <smart-tree id="columnsTree" allow-drag allow-drop animation="[[animation]]" filterable selection-mode="zeroOrOne" right-to-left="[[rightToLeft]]" theme="[[theme]]" unfocusable="[[unfocusable]]" aria-label="Columns"></smart-tree>\n                            </div>\n                            <div id="rowGroups" class="smart-pivot-panel-active-columns" role="presentation">\n                                <div id="rowGroupsLabel" class="smart-pivot-panel-row-groups-label smart-pivot-panel-label"><span class="icon" aria-hidden="true"></span><span></span></div>\n                                <smart-tree id="rowGroupsTree" allow-drag allow-drop animation="[[animation]]" selection-mode="zeroOrOne" right-to-left="[[rightToLeft]]" theme="[[theme]]" unfocusable="[[unfocusable]]"></smart-tree>\n                            </div>\n                            <div id="summaries" class="smart-pivot-panel-active-columns" role="presentation">\n                                <div id="summariesLabel" class="smart-pivot-panel-summaries-label smart-pivot-panel-label"><span class="icon" aria-hidden="true"></span><span></span></div>\n                                <smart-tree id="summariesTree" allow-drag allow-drop animation="[[animation]]" selection-mode="zeroOrOne" right-to-left="[[rightToLeft]]" theme="[[theme]]" unfocusable="[[unfocusable]]"></smart-tree>\n                            </div>\n                            <div id="pivots" class="smart-pivot-panel-active-columns" role="presentation">\n                                <div id="pivotsLabel" class="smart-pivot-panel-pivots-label smart-pivot-panel-label"><span class="icon" aria-hidden="true"></span><span></span></div>\n                                <smart-tree id="pivotsTree" allow-drag allow-drop animation="[[animation]]" selection-mode="zeroOrOne" right-to-left="[[rightToLeft]]" theme="[[theme]]" unfocusable="[[unfocusable]]"></smart-tree>\n                            </div>\n                        </div>\n                        <div id="filtersView" class="smart-pivot-panel-filters-view" role="tabpanel"></div>\n                    </div>\n                    <div id="tabs" class="smart-pivot-panel-tabs smart-unselectable">\n                        <div id="columnsTab" class="smart-pivot-panel-tab-item" role="tab" aria-selected="false"><span class="icon" aria-hidden="true"></span><span></span></div>\n                        <div id="filtersTab" class="smart-pivot-panel-tab-item" role="tab" aria-selected="false"><span class="icon" aria-hidden="true"></span><span></span></div>\n                    </div>\n                </div>'}render(){const e=this;e._isMobile=Smart.Utilities.Core.isMobile,e._initializedFilters={},e._cachedFilters={},e._setFocusable(),e._localize(),e._setAriaRelations(),e.dataSource instanceof Smart.DataAdapter&&(e.dataSource=e.dataSource.toArray()),"columns"===e.view?(e.$.columnsTab.classList.add("selected"),e.$.columnsTab.setAttribute("aria-selected",!0),e.$.filtersView.remove(),e._initializeColumnsView()):(e.$.filtersTab.classList.add("selected"),e.$.filtersTab.setAttribute("aria-selected",!0),e.$.columnsView.remove(),e._initializeFiltersView()),super.render()}attached(){const e=this;super.attached(),e.isCompleted&&e._dialog&&(e._addDialogHandlers(),e.getShadowRootOrBody().appendChild(e._dialog))}detached(){if(super.detached(),!this._dialog)return;const e=this._dialog;e.removeEventListener("close",this._dialogCloseHandler),e.removeEventListener("click",this._dialogClickHandler),e.remove()}propertyChangedHandler(e,t,a){super.propertyChangedHandler(e,t,a);const l=this;switch(e){case"animation":case"disabled":case"rightToLeft":case"theme":case"unfocusable":if("disabled"!==e&&"unfocusable"!==e||l._setFocusable(),l._columnsViewInitialized&&"filters"===l.view&&[l.$.columnsTree,l.$.rowGroupsTree,l.$.summariesTree,l.$.pivotsTree].forEach(t=>t[e]=a),l._filtersViewInitialized){Array.from(l.$.filtersView.querySelectorAll("smart-filter-panel")).forEach(t=>t[e]=a),"animation"!==e&&(l.$.filtersView.querySelector("smart-accordion")[e]=a)}if(l._dialog){Array.from(l._dialog.$.container.querySelectorAll(".editor, .ok, .cancel")).forEach(t=>t[e]=a),l._dialog[e]=a}break;case"columns":case"dataSource":if("dataSource"===e&&l.dataSource instanceof Smart.DataAdapter&&(l.dataSource=l.dataSource.toArray()),"columns"===e&&l._columnsViewInitialized&&(delete l._columnsViewInitialized,"columns"===l.view&&l._initializeColumnsView()),l._filtersViewInitialized)if("columns"!==e||t.map(e=>e.dataField).join(",")!==a.map(e=>e.dataField).join(",")){if("columns"===e){Array.from(l.$.filtersView.querySelectorAll("smart-accordion-item.filtered smart-filter-panel")).forEach(e=>{l._cachedFilters[e.column.dataField]=e.$.mainContainer.firstElementChild.selectedIndexes})}delete l._filtersViewInitialized,l._initializedFilters={},l.$.filtersView.innerHTML="","filters"===l.view&&l._initializeFiltersView()}else if("columns"===e){Array.from(l.$.filtersView.querySelectorAll("smart-accordion-item, smart-filter-panel")).forEach(e=>{e.column=a.find(t=>t.dataField===e.column.dataField)})}break;case"locale":case"messages":{const e=Array.from(l.$.filtersView.querySelectorAll("smart-filter-panel")),t=l._dialog;l._localize(),e.forEach(e=>{e.messages.en.clear=l.localize("clear"),e.messages.en.filter=l.localize("filter"),e.messages.en.showRows=l.localize("showRows"),e.propertyChangedHandler("messages")}),t&&(t.close(),t.removeEventListener("close",l._dialogCloseHandler),t.removeEventListener("click",l._dialogClickHandler),t.remove(),delete l._dialog);break}case"view":l._tabsClickHandler({target:l.$[a+"Tab"]})}}_localize(){this.$.columnsTab.children[1].innerHTML=this.localize("columns"),this.$.filtersTab.children[1].innerHTML=this.localize("filters"),this.$.columnsTree.filterInputPlaceholder=this.localize("search"),this.$.rowGroupsLabel.children[1].innerHTML=this.localize("rowGroups"),this.$.summariesLabel.children[1].innerHTML=this.localize("summaries"),this.$.pivotsLabel.children[1].innerHTML=this.localize("pivots")}_initializeColumnsView(){this._columnsViewInitialized||(this._columnsViewInitialized=!0,this._createColumnItems())}_initializeFiltersView(){const e=this;if(e._filtersViewInitialized)return;const t=e.columns,a=document.createElement("smart-accordion");e._filtersViewInitialized=!0;for(let l=0;l<t.length;l++){const r=t[l],i=document.createElement("smart-accordion-item");i.label=r.label,i.column=r,0===l&&e._initFilterPanel(i),e._cachedFilters[r.dataField]&&i.classList.add("filtered"),a.appendChild(i)}a.animation="none",a.expandMode="single",a.rightToLeft=e.rightToLeft,a.theme=e.theme,a.unfocusable=e.unfocusable,e.$.filtersView.appendChild(a)}_initFilterPanel(e){const t=this,a=e.column,l=a.dataField;if(t._initializedFilters[l]){const t=e.querySelector("smart-filter-panel");return void(0===t._filterHandler.filterObject.filters.length&&t._filterHandler.tree.select("0"))}const r=document.createElement("smart-filter-panel"),i=a.dataType;r.animation=t.animation,r.column=a,r.disabled=!1===a.allowFilter,r.filterType="number"===i?"numeric":i,r.mode="excel",r.data=t.dataSource,r.dataField=l,r.messages.en.clear=t.localize("clear"),r.messages.en.filter=t.localize("filter"),r.messages.en.showRows=t.localize("showRows"),r.rightToLeft=t.rightToLeft,r.theme=t.theme,r.unfocusable=t.unfocusable,e.isRendered?e.$.contentContainer.appendChild(r):e.appendChild(r),t._initializedFilters[l]=!0,t._cachedFilters[l]&&r.whenRendered((function(){r.$.mainContainer.firstElementChild.selectedIndexes=t._cachedFilters[l],r._filterHandler.excelFilter(),delete t._cachedFilters[l]}))}_accordionItemExpandingHandler(e){const t=this.isInShadowDOM?e.composedPath()[0]:e.target;if(t instanceof Smart.Accordion==!1)return;const a=t._items[e.detail.index];this._initFilterPanel(a)}_filterPanelFilterHandler(e){const t=(this.isInShadowDOM?e.composedPath()[0]:e.target).closest("smart-accordion-item");"clear"!==e.type||t.classList.contains("filtered")||e.stopPropagation(),t.classList.toggle("filtered","filter"===e.type)}_tabsClickHandler(e){const t=this,a=t.view,l=e.type&&t.isInShadowDOM?e.composedPath()[0]:e.target;if(t.$.columnsTab.contains(l)){if("columns"===a&&e.type)return;return t.view="columns",t.$.columnsTab.classList.add("selected"),t.$.columnsTab.setAttribute("aria-selected",!0),t.$.filtersTab.classList.remove("selected"),t.$.filtersTab.setAttribute("aria-selected",!1),t.$.filtersView.remove(),t.$.main.appendChild(t.$.columnsView),void t._initializeColumnsView()}if(t.$.filtersTab.contains(l)){if("filters"===a&&e.type)return;t.view="filters",t.$.filtersTab.classList.add("selected"),t.$.filtersTab.setAttribute("aria-selected",!0),t.$.columnsTab.classList.remove("selected"),t.$.columnsTab.setAttribute("aria-selected",!1),t.$.columnsView.remove(),t.$.main.appendChild(t.$.filtersView),t._initializeFiltersView()}}_createColumnItems(e){const t=this,a=t.columns,l=[],r=[],i=[],o=[];for(let t=0;t<a.length;t++){const n=a[t];n.allowPivot&&n.pivot&&l.push(n),n.allowRowGroup&&n.rowGroup&&r.push(n),n.summary&&i.push(n),!1!==e&&o.push({label:n.label,value:n})}function n(e,a){const l=[];for(let a=0;a<e.length;a++)l.push({label:t._getTreeItemLabel(e[a]),value:e[a]});a.dataSource=l}n(l,t.$.pivotsTree),n(r,t.$.rowGroupsTree),n(i,t.$.summariesTree),!1!==e&&(t.$.columnsTree.dataSource=o)}_summariesTreeDragStartHandler(e){const t=this.$.summariesTree;1===Object.keys(t.items).length&&e.preventDefault()}_draggingHandler(e){const t=this,a=e.detail.data.Feedback,l=e.detail.item.closest("smart-tree"),r=e.detail.originalEvent.originalEvent,i=t._isMobile?t.getRootNode().elementFromPoint(r.clientX,r.clientY):t.isInShadowDOM?r.composedPath()[0]:r.target,o=i.closest("smart-tree"),n=e.detail.item.value,s=t.ownerElement;if(t._breadcrumbTarget&&(t._breadcrumbTarget.$.container.classList.remove("drop-target"),delete t._breadcrumbTarget),s&&s.contains(i)){const e=i.closest("smart-breadcrumb");if(e)return a.classList.remove("forbidden"),e===s.$.rowGroupBreadcrumb?n.allowRowGroup?n.rowGroup||e.$.container.classList.add("drop-target"):a.classList.add("forbidden"):n.allowPivot?n.pivot||e.$.container.classList.add("drop-target"):a.classList.add("forbidden"),void(t._breadcrumbTarget=e)}l===t.$.columnsTree&&!o||o===t.$.rowGroupsTree&&!n.allowRowGroup||o===t.$.pivotsTree&&!n.allowPivot?a.classList.add("forbidden"):a.classList.remove("forbidden")}_dragEndHandler(e){const t=this,a=e.detail,l=a.previousContainer,r=a.container,i=a.item,o=t.columns.find(e=>e.dataField===i.value.dataField),n=a.target,s=a.data.DropDetails?a.data.DropDetails.position:void 0;function d(){switch(r){case t.$.rowGroupsTree:return!!o.allowRowGroup&&(o.rowGroup=!0,!0);case t.$.summariesTree:return o.summary||(o.summary=t._getDefaultSummaryFunction(o)),!0;case t.$.pivotsTree:return!!o.allowPivot&&(o.pivot=!0,!0)}}function c(){const e=document.createElement("smart-tree-item");return e.label=t._getTreeItemLabel(o),e.value=o,e}function u(){if(l!==r)switch(l){case t.$.rowGroupsTree:delete o.rowGroup;break;case t.$.summariesTree:delete o.summary;break;case t.$.pivotsTree:delete o.pivot}}function m(){if(n.value)return t.columns.find(e=>e.dataField===n.value.dataField)}if(t._breadcrumbTarget)t._breadcrumbDropHandler(o,l);else{if(l===t.$.columnsTree){if(r instanceof Smart.Tree==!1)return i.selected=!!(o.pivot||o.rowGroup||o.summary),void e.preventDefault();if(r===l){let e=!1;return(o.rowGroup&&Object.keys(t.$.rowGroupsTree.items).length>1||o.summary&&Object.keys(t.$.summariesTree.items).length>1||o.pivot&&Object.keys(t.$.pivotsTree.items).length>1)&&(e=!0),void requestAnimationFrame(()=>{const a=t.context;t.context=t,t.columns=t.$.columnsTree.dataSource.map(e=>e.value),e&&(t._createColumnItems(!1),t.$.fireEvent("change",{columns:JSON.parse(JSON.stringify(t.columns))})),t.context=a})}return Object.values(r._menuItems).find(e=>e.value===o)||(d()?(0===r.dataSource.length?r.insert({label:t._getTreeItemLabel(o),value:o}):("top"===s?r.addBefore(c(),n):r.addAfter(c(),n),t._reorder(o,m(),s)),t.$.fireEvent("change",{columns:JSON.parse(JSON.stringify(t.columns))})):i.selected=!!(o.pivot||o.rowGroup||o.summary)),void e.preventDefault()}if(r instanceof Smart.Tree==!1||r===t.$.columnsTree)return u(),l.removeItem(i),t.$.fireEvent("change",{columns:JSON.parse(JSON.stringify(t.columns))}),void e.preventDefault();d()?(u(),t._reorder(o,m(),s),t.$.fireEvent("change",{columns:JSON.parse(JSON.stringify(t.columns))})):e.preventDefault()}}_reorder(e,t,a){const l=this.columns,r=l.indexOf(e);let i=l.indexOf(t);void 0===e||void 0===t||r>i&&"bottom"===a||r<i&&"top"===a||(l.splice(r,1),i=l.indexOf(t),"bottom"===a?l.splice(i+1,0,e):l.splice(i,0,e),this.columns=l,this.$.columnsTree.dataSource=l.map(e=>({label:e.label,value:e,selected:!!(e.pivot||e.rowGroup||e.summary)})))}_breadcrumbDropHandler(e,t){const a=this,l=a._breadcrumbTarget,r=a.ownerElement,i=r.columns.find(t=>t.dataField===e.dataField),o=a.context;function n(){switch(a.context=document,r.columns.canNotify=!1,t){case a.$.rowGroupsTree:i.rowGroup=void 0;break;case a.$.summariesTree:i.summary=void 0;break;case a.$.pivotsTree:i.pivot=void 0}}if(l.$.container.classList.remove("drop-target"),delete a._breadcrumbTarget,l===r.$.rowGroupBreadcrumb){if(!e.allowRowGroup||e.rowGroup)return;n(),i.rowGroup=!0}else{if(!e.allowPivot||e.pivot)return;n(),i.pivot=!0}r._refreshColumns(),a.context=o,r.columns.canNotify=!0}_getTreeItemLabel(e){return'<span class="settings-icon"></span>'+e.label}_settingsIconClickHandler(e){const t=this.isInShadowDOM?e.composedPath()[0]:e.target;t.classList.contains("settings-icon")&&this._openDialog(t.closest("smart-tree-item"))}_openDialog(e){const t=this;t._dialog||t._createDialog();const a=t._dialog,l=e.value,r=!!l.summary,i=Array.from(a.$.container.querySelectorAll(".editor"));let o=l.align||"left";if(t.$.container.setAttribute("modal",""),t._editedItem=e,a.classList.toggle("summary",r),a.setAttribute("aria-controls",e.id),i[0].value="",i[0].$.input.dataValue="",i[0].disabled=e.menu===t.$.summariesTree&&1===Object.keys(e.menu.items).length,i[1].value=t.localize(o),i[1].$.input.dataValue=o,r){let e=Object.assign({align:"left",prefix:"",decimalPlaces:0,thousandsSeparator:"",decimalSeparator:".",negativesInBrackets:!1},l.summarySettings||{});i[2].value=l.summary,i[2].disabled=t.ownerElement&&t.ownerElement.columnTotals,i[3].value=t.localize(e.align),i[3].$.input.dataValue=e.align,i[4].value=e.prefix,i[5].value=e.decimalPlaces.toString(),i[6].value=e.thousandsSeparator,i[7].value=e.decimalSeparator,i[8].checked=e.negativesInBrackets}a.open()}_createDialog(){const e=this.id,t=document.createElement("smart-window"),a=document.createElement("template"),l=` animation=${this.animation} theme="${this.theme}"${this.rightToLeft?" right-to-left":""}${this.unfocusable?" unfocusable":""}`;a.innerHTML=`<smart-button class="ok primary"${l}>${this.localize("ok")}</smart-button>\n<smart-button class="cancel"${l}>${this.localize("cancel")}</smart-button>`;const r=JSON.stringify([{label:this.localize("columns"),value:"columns"},{label:this.localize("rowGroups"),value:"rowGroups"},{label:this.localize("summaries"),value:"summaries"},{label:this.localize("pivots"),value:"pivots"}]),i=JSON.stringify([{label:this.localize("left"),value:"left"},{label:this.localize("center"),value:"center"},{label:this.localize("right"),value:"right"}]),o=JSON.stringify(["min","max","sum","avg","stdev","stdevp","var","varp","product","count","median"]);t.animation=this.animation,t.footerTemplate=a,t.headerButtons=["close"],t.label=this.localize("columnSettings"),t.rightToLeft=this.rightToLeft,t.theme=this.theme,t.unfocusable=this.unfocusable,t.className="smart-pivot-window",t.innerHTML=`<div id="${e}MoveToLabel" class="label">${this.localize("moveTo")}</div>\n            <div><smart-input class="editor underlined move-to"${l} data-source='${r}' drop-down-button-position="right" readonly aria-labelledby="${e}MoveToLabel"></smart-input></div>\n            <div id="${e}TextAlignmentLabel" class="label">${this.localize("textAlignment")}</div>\n            <div><smart-input class="editor underlined text-alignment"${l} data-source='${i}' drop-down-button-position="right" readonly aria-labelledby="${e}TextAlignmentLabel"></smart-input></div>\n            <div id="${e}CalculationLabel" class="label summary">${this.localize("calculation")}</div>\n            <div class="summary"><smart-input class="editor underlined calculation"${l} data-source='${o}' drop-down-button-position="right" readonly aria-labelledby="${e}CalculationLabel"></smart-input></div>\n            <div class="label category summary">${this.localize("numberFormat")}</div>\n            <div id="${e}NumberAlignmentLabel" class="label summary">${this.localize("numberAlignment")}</div>\n            <div class="summary"><smart-input class="editor underlined number-alignment"${l} data-source='${i}' drop-down-button-position="right" readonly aria-labelledby="${e}NumberAlignmentLabel"></smart-input></div>\n            <div id="${e}NumberPrefixLabel" class="label summary">${this.localize("numberPrefix")}</div>\n            <div class="summary"><smart-input class="editor underlined number-prefix"${l} aria-labelledby="${e}NumberPrefixLabel"></smart-input></div>\n            <div id="${e}DecimalPlacesLabel" class="label summary">${this.localize("decimalPlaces")}</div>\n            <div class="summary"><smart-input class="editor underlined decimal-places"${l} aria-labelledby="${e}DecimalPlacesLabel"></smart-input></div>\n            <div id="${e}ThousandsSeparatorLabel" class="label summary">${this.localize("thousandsSeparator")}</div>\n            <div class="summary"><smart-input class="editor underlined thousands-separator"${l} aria-labelledby="${e}ThousandsSeparatorLabel"></smart-input></div>\n            <div id="${e}DecimalSeparatorLabel" class="label summary">${this.localize("decimalSeparator")}</div>\n            <div class="summary"><smart-input class="editor underlined decimal-separator"${l} aria-labelledby="${e}DecimalSeparatorLabel"></smart-input></div>\n            <div id="${e}NegativesInBracketsLabel" class="label summary">${this.localize("negativesInBrackets")}</div>\n            <div class="summary"><smart-check-box class="editor"${l} aria-labelledby="${e}NegativesInBracketsLabel"></smart-check-box></div>`,t.ownerElement=this,this._dialog=t,this._addDialogHandlers(),this.getShadowRootOrBody().appendChild(t),this.setAttribute("aria-owns",t.id)}_addDialogHandlers(){const e=this._dialog;e.addEventListener("close",this._dialogCloseHandler),e.addEventListener("click",this._dialogClickHandler)}_dialogClickHandler(e){const t=this,a=t.isInShadowDOM?e.composedPath()[0]:e.target;a.closest(".ok")?(t.ok=!0,t.close()):a.closest(".cancel")&&t.close()}_dialogCloseHandler(){const e=this.ownerElement,t=e._dialog,a=e.context;if((t.isInShadowDOM?event.composedPath()[0]:event.target)!==t)return;const l=e._editedItem;if(e.context=e,e.$.container.removeAttribute("modal"),l.menu.focus(),t.ok){const a=l.value,r=Array.from(t.$.container.querySelectorAll(".editor")),i=r[0].$.input.dataValue,o=r[1].$.input.dataValue;let n=!1,s=!1;if(i&&!("rowGroups"===i&&(a.rowGroup||!a.allowRowGroup)||"summaries"===i&&a.summary||"pivots"===i&&(a.pivot||!a.allowPivot))){const t=l.menu;let r;switch(t.removeItem(l.path),t){case e.$.rowGroupsTree:delete a.rowGroup;break;case e.$.summariesTree:delete a.summary;break;case e.$.pivotsTree:delete a.pivot}switch(i){case"rowGroups":r=e.$.rowGroupsTree,a.rowGroup=!0;break;case"summaries":r=e.$.summariesTree,a.summary=e._getDefaultSummaryFunction(a),s=!0;break;case"pivots":r=e.$.pivotsTree,a.pivot=!0}if(r){const t=document.createElement("smart-tree-item");t.label=e._getTreeItemLabel(a),t.value=a,r.addTo(t),t.previousElementSibling&&e._reorder(a,t.previousElementSibling.value,"bottom")}n=!0}if((!a.align&&"left"!==o||a.align&&a.align!==o)&&(a.align=o,n=!0),a.summary&&!s){const e={align:"left",prefix:"",decimalPlaces:0,thousandsSeparator:"",decimalSeparator:".",negativesInBrackets:!1},t=a.summarySettings,l={align:r[3].$.input.dataValue,prefix:r[4].value,decimalPlaces:parseFloat(r[5].value),thousandsSeparator:r[6].value,decimalSeparator:r[7].value,negativesInBrackets:r[8].checked},i=r[2].value;if(isNaN(l.decimalPlaces)&&(l.decimalPlaces=t?t.decimalPlaces:0),i!==a.summary&&(a.summary=i,n=!0),t){const r=Object.assign({},e,t);Object.keys(r).forEach(e=>{r[e]!==l[e]&&(a.summarySettings[e]=l[e],n=!0)})}else JSON.stringify(e)!==JSON.stringify(l)&&(a.summarySettings=l,n=!0)}delete t.ok,n&&e.$.fireEvent("change",{columns:JSON.parse(JSON.stringify(e.columns))})}delete e._editedItem,e.context=a}_setFocusable(){const e=this;if(e.disabled||e.unfocusable)return e.$.columnsTab.removeAttribute("tabindex"),void e.$.filtersTab.removeAttribute("tabindex");const t=e.$.columnsTab.getAttribute("tabindex");(null===t||t<0)&&(e.$.columnsTab.setAttribute("tabindex",0),e.$.filtersTab.setAttribute("tabindex",0))}_keydownHandler(e){const t=this,a=e.key,l=t.getRootNode().activeElement;if("Enter"!==a&&" "!==a||l!==t.$.columnsTab&&l!==t.$.filtersTab){if("Enter"===a&&-1!==[t.$.rowGroupsTree,t.$.summariesTree,t.$.pivotsTree].indexOf(l)){const e=l.querySelector("[focus]");e&&this._openDialog(e)}}else t._tabsClickHandler({target:l})}_getDefaultSummaryFunction(e){const t=this.ownerElement;return t&&t._getDefaultSummaryFunction?t._getDefaultSummaryFunction(e):"count"}_setAriaRelations(){const e=this.id;this.setAttribute("role","tablist"),this.$.columnsView.id=e+"ColumnsView",this.$.columnsTab.id=e+"columnsTab",this.$.columnsTab.setAttribute("aria-controls",this.$.columnsView.id),this.$.columnsView.setAttribute("aria-labelledby",this.$.columnsTab.id),this.$.filtersView.id=e+"FiltersView",this.$.filtersTab.id=e+"FiltersTab",this.$.filtersTab.setAttribute("aria-controls",this.$.filtersView.id),this.$.filtersView.setAttribute("aria-labelledby",this.$.filtersTab.id),this.$.rowGroupsLabel.id=e+"RowGroupsLabel",this.$.rowGroupsTree.setAttribute("aria-labelledby",this.$.rowGroupsLabel.id),this.$.summariesLabel.id=e+"SummariesLabel",this.$.summariesTree.setAttribute("aria-labelledby",this.$.summariesLabel.id),this.$.pivotsLabel.id=e+"PivotsLabel",this.$.pivotsTree.setAttribute("aria-labelledby",this.$.pivotsLabel.id)}})}});